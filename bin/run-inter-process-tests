#Only verifies the inter-process tests of projet. Typically involves the creation of a project and requires a name suffix. No Sonar, Checkstyle, OWASP
set -e
if [ "${PIPELINE_KIND}" == "release" ]; then
    IMAGE_VERSION="${VERSION}"
    SUFFIX="${PIPELINE_CODE}ms"
    BUILD_NAME=master
else
    IMAGE_VERSION="${PREVIEW_VERSION}"
    SUFFIX="${PIPELINE_CODE}pr${PULL_NUMBER}"
    BUILD_NAME="PR-${PULL_NUMBER}"
fi
mvn verify -Pcicd -Pinter-process-verification \
    -Dentando.docker.registry.override=${DOCKER_REGISTRY} \
    -Dentando.docker.image.version.fallback=6.0.0 \
    -Dentando.k8s.operator.tests.run.target=K8S \
    -Dentando.default.routing.suffix=${ENTANDO_DEFAULT_ROUTING_SUFFIX} \
    -Dentando.test.namespace.override=${REPO_NAME} \
    -Dentando.test.name.suffix=${SUFFIX} \
    -Dentando.test.image.version=${IMAGE_VERSION} \
    -Dentando.k8s.operator.configmap.namespace=entando
result=$?
set -e
verify-build ${BUILD_NAME}
exit $result

